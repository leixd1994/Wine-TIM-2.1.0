(function(){if(!Array.prototype.map){Array.prototype.map=function(j,g){var d,e,b;if(this==null){throw new TypeError(" this is null or not defined")}var i=Object(this);var h=i.length>>>0;if({}.toString.call(j)!="[object Function]"){throw new TypeError(j+" is not a function")}if(g){d=g}e=new Array(h);b=0;while(b<h){var c,f;if(b in i){c=i[b];f=j.call(d,c,b,i);e[b]=f}b++}return e}}if(!Array.prototype.reduce){Array.prototype.reduce=function a(c){var d=0,e=this.length>>0,b;if(typeof c!=="function"){throw new TypeError("First argument is not callable")}if(arguments.length<2){if(e===0){throw new TypeError("Array length is 0 and no second argument")}b=this[0];d=1}else{b=arguments[1]}while(d<e){if(d in this){b=c.call(undefined,b,this[d],d,this)}++d}return b}}if(!Array.prototype.forEach){Array.prototype.forEach=function(h,f){var d,g;if(this==null){throw new TypeError(" this is null or not defined")}var e=Object(this);var b=e.length>>>0;if({}.toString.call(h)!="[object Function]"){throw new TypeError(h+" is not a function")}if(f){d=f}g=0;while(g<b){var c;if(g in e){c=e[g];h.call(d,c,g,e)}g++}}}if(!Array.prototype.filter){Array.prototype.filter=function(h){if(this==null){throw new TypeError()}var c=Object(this);var b=c.length>>>0;if(typeof h!="function"){throw new TypeError()}var e=[];var g=arguments[1];for(var f=0;f<b;f++){if(f in c){var d=c[f];if(h.call(g,d,f,c)){e.push(d)}}}return e}}if(!Array.prototype.every){Array.prototype.every=function(f){if(this==null){throw new TypeError()}var c=Object(this);var b=c.length>>>0;if(typeof f!="function"){throw new TypeError()}var e=arguments[1];for(var d=0;d<b;d++){if(d in c&&!f.call(e,c[d],d,c)){return false}}return true}}if(!Array.prototype.each){Array.prototype.each=function(b){b=b||Function.K;var d=[];var c=Array.prototype.slice.call(arguments,1);for(var f=0;f<this.length;f++){var e=b.apply(this,[this[f],f].concat(c));if(e!=null){d.push(e)}}return d}}if(!Array.prototype.contains){Array.prototype.contains=function(c){for(var b=0;b<this.length;b++){if(this[b]==c){return true}}return false}}if(!Array.prototype.uniquelize){Array.prototype.uniquelize=function(){var c=new Array();for(var b=0;b<this.length;b++){if(!c.contains(this[b])){c.push(this[b])}}return c}}if(!Array.complement){Array.complement=function(c,d){return Array.minus(Array.union(c,d),Array.intersect(c,d))}}if(!Array.intersect){Array.intersect=function(c,d){return c.uniquelize().each(function(b){return d.contains(b)?b:null})}}if(!Array.minus){Array.minus=function(c,d){return c.uniquelize().each(function(b){return d.contains(b)?null:b})}}if(!Array.union){Array.union=function(c,d){return c.concat(d).uniquelize()}}})();(function(c){var f=function(){};f.version="0.0.1";var o;var i=Math,e=i.round,k=i.floor,d=i.ceil,m=i.max,g=i.min,h=i.abs,j=i.cos,b=i.sin,a=i.PI,n=a*2/360;f.themes={colors:["#514F78","#42A07B","#9B5E4A","#72727F","#1F949A","#82914E","#86777F","#42A07B"],chart:{className:"skies",borderWidth:0}};f.Hashtable=function(){this._hash={};this._count=0;this.add=function(q,p){if(this._hash.hasOwnProperty(q)){return false}else{this._hash[q]=p;this._count++;return true}};this.remove=function(p){delete this._hash[p];this._count--};this.count=function(){return this._count};this.items=function(p){if(this.contains(p)){return this._hash[p]}};this.contains=function(p){return this._hash.hasOwnProperty(p)};this.clear=function(){this._hash={};this._count=0}};f.utility={pInt:function(q,p){return parseInt(q,p||10)},isString:function(p){return typeof p==="string"},isObject:function(p){return typeof p==="object"},isArray:function(p){return Object.prototype.toString.call(p)==="[object Array]"},isNumber:function(p){return typeof p==="number"},splat:function(p){return isArray(p)?p:[p]},defined:function(p){return p!==o&&p!==null},pick:function(){var q=arguments,r,p,s=q.length;for(r=0;r<s;r++){p=q[r];if(typeof p!=="undefined"&&p!==null){return p}}}};f.getObjLength=function(q){var p=0;if(q){c.each(q,function(s,r){p++})}return p};f.getColor=function(q){var p=f.themes.colors;return p[q%p.length]};f.getColorCustom=function(p,q){return q[p%q.length]};f.setOptions=function(p,q){return c.extend(true,{},p||{},q||{})};f.getAngle=function(p){var q=p>180?270:90;return p-q};f.pad=function(p,q){return new Array((q||2)+1-String(p).length).join(0)+p};f.dateFormat=function(t,w){if(!f.utility.defined(t)||isNaN(t)){return"Invalid date"}w=f.utility.pick(w,"%Y-%m-%d");var u=new Date(t);var v=u.getHours();var p=u.getDay();var s=u.getDate();var q=u.getMonth();var r=u.getFullYear();var x={d:f.pad(s),e:s,m:f.pad(q+1),y:r.toString().substr(2,2),Y:r,I:f.pad((v%12)||12),l:(v%12)||12,M:f.pad(u.getMinutes()),p:v<12?"AM":"PM",P:v<12?"am":"pm",S:f.pad(u.getSeconds()),L:f.pad(e(t%1000),3)};for(key in x){while(w.indexOf("%"+key)!==-1){w=w.replace("%"+key,typeof x[key]==="function"?x[key](t):x[key])}}return w};f.angle=function(p,s,r,q){return Raphael.angle(p,s,r,q)};f.distanceMap=function(t,q,p,s,r){t=t>q?q:t;t=t<p?p:t;return q==p?r:(t-p)/(q-p)*(s-r)+r};f.getLinePath=function(p,t,r,q){var s=["M",p,t,"L",r,q];return s};f.getArrowPath=function(u,A,E,B,y,F,v){y=typeof(y)=="undefined"?8:y;F=typeof(F)=="undefined"?30:F;v=typeof(v)=="undefined"?0.5:v;var G=f.angle(u,A,E,B);var z=Raphael.rad(G);var p=Raphael.rad(G-F);var w=Raphael.rad(G+F);var C=E+Math.cos(p)*y;var D=B+Math.sin(p)*y;var s=E+Math.cos(w)*y;var t=B+Math.sin(w)*y;var q=E+Math.cos(z)*y*v;var r=B+Math.sin(z)*y*v;var x=["M",u,A,"L",q,r,"L",C,D,"L",E,B,"L",s,t,"L",q,r+"z"];return x};f.getCurvePath=function(p,s,q){var r=["M",p,s,"C"].concat(q);return r};f.getCurveArrowPath=function(t,A,s,y,D,v){y=typeof(y)=="undefined"?8:y;var p=[];if(f.utility.isArray(s)&&s.length>=6){var B=s[2];var z=s[3];var G=s[4];var F=s[5];var E=f.angle(B,z,G,F);var C=Raphael.rad(E);var x=G+Math.cos(C)*y;var w=F+Math.sin(C)*y;var r=s.slice(0);r[4]=x;r[5]=w;var u=f.getCurvePath(t,A,r);var q=f.getArrowPath(x,w,G,F,y);p=u.concat(q)}return p};f.range=function(r,u,q){if(arguments.length<3){q=1;if(arguments.length<2){u=r;r=0}}if((u-r)/q==Infinity){throw new Error("infinite range")}var p=[],s=-1,t;if(q<0){while((t=r+q*++s)>u){p.push(t)}}else{while((t=r+q*++s)<u){p.push(t)}}return p};f.functor=function(p){return typeof p==="function"?p:function(){return p}};f.rebind=function(r,s){var q=1,p=arguments.length,t;while(++q<p){r[t=arguments[q]]=l(r,s,s[t])}return r};function l(q,r,p){return function(){var s=p.apply(r,arguments);return arguments.length?q:s}}f.ascending=function(p,q){return p<q?-1:p>q?1:p>=q?0:NaN};f.descending=function(p,q){return q<p?-1:q>p?1:q>=p?0:NaN};f.FloatTag=function(){var r;var p={tag:{color:"#333333",borderWidth:"1",borderColor:"#4572A7",backgroundColor:"#fff",fontColor:"#333333",fontSize:"12px",fontFamiliy:"宋体",opacity:0.9,padding:"8px"}};var q=function(t,s){r=this;var x=r.options=f.setOptions(p,s||{});var u=c("<div/>").css({border:x.tag.borderWidth+"px solid","border-color":x.tag.borderColor,"background-color":x.tag.backgroundColor,color:x.tag.fontColor,"font-familiy":x.tag.fontFamiliy,"font-size":x.tag.fontSize,"border-radius":"2px",padding:x.tag.padding,opacity:x.tag.opacity,"z-index":10000,display:"none","text-align":"center",position:"absolute"});var v={x:10,y:10};var w=(x.chart&&x.chart.width)?x.chart.width:t.width();t.css("position","relative");t.append(u).mousemove(function(B){if(!(B.pageX&&B.pageY)){return false}var z=B.pageX-t.offset().left,A=B.pageY-t.offset().top;floatTagWidth=u.outerWidth();floatTagHeight=u.outerHeight();if(floatTagWidth+z+2*v.x<=w){z+=v.x}else{z=z-floatTagWidth-v.x}if(A>=floatTagHeight+v.y){A=A-v.y-floatTagHeight}else{A+=v.y}u.css("left",z+"px");u.css("top",A+"px")});return u};return q};f.toString=function(){return"You are running NiceD with version:"+this.version};window.NiceD=f;if(typeof define==="function"){define("niceD",[],function(){return f})}})(jQuery);(function(a,b){var c={};c.center=function(){var d=[1,1];function e(n){var g=n;var q;var s=360;var h,i;h=g.x=d[0]/2;i=g.y=d[1]/2;q=g.children;if(q&&q.length>0){q.sort(function(y,z){var w=parseInt(y.length,10);var x=parseInt(z.length,10);return w>x?1:w==x?0:-1});var t=q.length;var m=true;var u=0;var o=0;var p=0;var v=0;var r=65535;var j=1;q.forEach(function(x,z){var A=parseInt(x.length,10);if(A>v){v=A}if(A<r){r=A}var y=x.name.length;if(y>o){o=y}var w=x.size;if(w>p){p=w}});if(v!=0){var f=h<i?h:i;f=f-p-o*5;j=f*0.8/v}if(m&&v>r){u=(v-r)/(t*2)}else{m=false}s=(360/q.length).toFixed(2);var l=null;var k=-1;q.forEach(function(y,A){var w=s*A/180*Math.PI;y.angle=s*A;var x=k=l==y.length?k:A;var z=m?(v-u*x)*j:y.length*j;y.lengthMap=z;y.x=h+z*Math.sin(w);y.y=i-z*Math.cos(w);y.mx=h+g.size*Math.sin(w);y.my=i-g.size*Math.cos(w);y.lx=h+(z-y.size)*Math.sin(w);y.ly=i-(z-y.size)*Math.cos(w);y.tx=h+(z+parseInt(y.size,10)+y.name.length*7)*Math.sin(w);y.ty=i-(z+parseInt(y.size,10)+y.name.length*7)*Math.cos(w);l=y.length})}return g}e.nodes=function(f){return e(f)};e.size=function(f){if(!arguments.length){return d}d=f;return e};return e};b.Layout=c;return b})(jQuery,NiceD);(function(d,a,f,e){var g;var c={chart:{renderTo:"NiceDChart",width:600,height:600},node:{radius:15,color:"#fff",stroke:"#fff",strokeWidth:2,fillOpacity:0.4,click:function(h){},hover:function(h){return h.name+11}},line:{length:180},label:{fontFamily:"微软雅黑",fontSize:12},animate:{biggerRate:1.2,time:100}};var b=function(h){g=this;g.options=e.setOptions(c,h||{});g.dataSource={};g.canvas=null;g.floatTag=e.FloatTag()(d("#"+g.options.chart.renderTo))};b.prototype.setDataSource=function(h){g.dataSource=g._arrayToJson(h)};b.prototype._arrayToJson=function(k){if(!k[0][0]||k[0][0].toUpperCase()!=="ID"){throw new Error(" table with first line field and first field id!")}var n=k.slice(1);var i;var m;var h=[];var j={};var l;n.forEach(function(r,o){var s=false;if(r[0]===""){throw new Error("ID can not be empty(line:"+(o+1)+").")}if(j[r[0]]){throw new Error("2 or more lines have same ID: "+r[0]+"(line:"+(o+1)+").")}if(!r[1]||r[1]==""){if(!i){i=r[0];s=true}else{throw new Error("2 or more lines have an empty parentID(line:"+(o+1)+").")}}var q=k[0];var p=[];r.forEach(function(t,u){p.push('"'+q[u]+'":"'+t+'"')});p.push('"isDraw":true');p.push('"index":'+o);if(s){p.push('"children":[]');m=l=a.parse("{"+p.join(",")+"}")}else{l=a.parse("{"+p.join(",")+"}");h.push(l)}j[r[0]]=l});if(i){m.children=h}else{throw new Error("No root node defined.")}return m};b.prototype._createCanvas=function(){var h=g.options;g.canvas=f(h.chart.renderTo,h.chart.width,h.chart.height)};b.prototype._layout=function(){var i=g.options;var h=e.Layout.center().size([i.chart.width,i.chart.height]);g.nodes=h.nodes(g.dataSource)};b.prototype._getLinkPath=function(h,l,k,i){var j=[["M",h,l],["L",k,i]];return j};b.prototype._getTextRotate=function(i){var h="0";if(i>=0&&i<=90){h="-"+(90-i)}else{if(i>90&&i<=180){h=i-90}else{if(i>180&&i<=270){h="-"+(270-i)}else{if(i>270&&i<=360){h=i-270}}}}return h};b.prototype._renderPlot=function(){var o=g.canvas;var l=g.options;var m=g.nodes;var p;var n=g._getLinkPath;var j=g._getTextRotate;var k=o.set();var i=[];var h=[];k.push(o.circle(m.x,m.y,m.size).attr({fill:m.fill,stroke:m.strokeFill,"stroke-width":m.strokeWidth,"fill-opacity":l.node.fillOpacity,cursor:"pointer",data:12}));h.push(null);i.push(o.text(m.x,m.y+e.utility.pInt(m.size,10)+7,m.name).attr({"font-size":l.label.fontSize}));p=m.children;if(p&&p.length>0){d.each(p,function(t,s){k.push(o.circle(s.x,s.y,s.size).attr({fill:s.fill,stroke:s.strokeFill,"stroke-width":s.strokeWidth,"fill-opacity":l.node.fillOpacity,cursor:"pointer",data:12}));var r=n(s.mx,s.my,s.lx,s.ly);h.push(o.path(r).attr({stroke:"#939598","stroke-width":s.lineWidth}));i.push(o.text(s.tx,s.ty,s.name).attr({"font-size":l.label.fontSize,transform:"r"+j(s.angle)}))})}var q=g.floatTag;k.forEach(function(v,r){var y=l.animate.biggerRate>=1?l.animate.biggerRate:1.2;var A=l.animate.time;var u=v.attr("r");var z=v.attr("stroke-width");var s=h[r];var w=s?s.attr("stroke-width"):1;var x=i[r];var t=x.attr("y");v.mouseover(function(){this.animate({r:u*y,"stroke-width":z*y,"fill-opacity":l.node.fillOpacity+0.2},A);x.attr({"font-size":l.label.fontSize+2});if(s){s.attr({"stroke-width":w*l.animate.biggerRate*2,"stroke-opacity":0.8})}var B=r==0?m:p[r-1];q.html(l.node.hover(B));q.stop(true,true).fadeIn("fast")}).mouseout(function(){this.animate({r:u,"stroke-width":z,"fill-opacity":l.node.fillOpacity},A);x.attr({"font-size":l.label.fontSize}).animate({y:t},A,"backOut");if(s){s.attr({"stroke-width":w,"stroke-opacity":0.8})}q.stop(true,true).fadeOut("fast")}).click(function(){if(s&&p&&r>0&&r<=p.length){l.node.click(p[r-1])}})})};b.prototype.render=function(){g._createCanvas();g._layout();g._renderPlot()};e.Center=b;return e})(jQuery,JSON,Raphael,NiceD);function renderAu(b){$("#NiceDChart").html("");var c={chart:{renderTo:"NiceDChart",width:650,height:600},node:{radius:15,color:"#fff",stroke:"#fff",strokeWidth:2,fillOpacity:0.8,hover:function(e){return e.name}},line:{center:180},label:{fontFamily:"微软雅黑",fontSize:12},animate:{biggerRate:1.2,time:100}};var a=b;var d=new NiceD.Center(c);d.setDataSource(a);d.render()}function RenderHightCharts(a,b,d){var c;$(document).ready(function(){$("#"+b).highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:false},title:{text:""},tooltip:{pointFormat:"<b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:true,cursor:"pointer",dataLabels:{enabled:true},showInLegend:true}},legend:{layout:"vertical",floating:false,backgroundColor:"#FFFFFF",align:"right",verticalAlign:"right"},credits:{enabled:false},series:[{type:a,name:"",data:d}]})})}function RenderLineChart(a){$("#KwsChart").highcharts({chart:{type:"spline"},title:{text:""},subtitle:{text:""},xAxis:{minTickInterval:1},yAxis:{title:{text:"主题频率"},min:0},credits:{enabled:false},tooltip:{},series:a})}function RenderRefChart(a){$("#chartref").Flash({swfFile:"/kcms/detail/resource/gb/chart/KCMSRelation.swf",expressInstall:"/kcms/detail/resource/gb/chart/playerProductInstall.swf",wmode:"Opaque",data:a}).mousewheel(function(){return false});$("#chartrefC").click(function(){$("#chartrefC").hide()});$("#chartref").mouseout(function(){$("#chartrefC").show()})}function RenderCoAuChart(a){$("#CoAuChart").Flash({swfFile:"/kcms/detail/resource/gb/chart/KCMSRelation.swf",expressInstall:"/kcms/detail/resource/gb/chart/playerProductInstall.swf",wmode:"Opaque",data:a,showColorYear:"false",showRightBar:"false",showReleationBar:"false"}).mousewheel(function(){return false});$("#CoAuChartC").click(function(){$("#CoAuChartC").hide()});$("#CoAuChart").mouseout(function(){$("#CoAuChartC").show()})};