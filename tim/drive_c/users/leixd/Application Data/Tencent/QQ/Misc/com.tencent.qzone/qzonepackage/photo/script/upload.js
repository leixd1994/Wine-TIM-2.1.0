/*
  Qzone Project By Qzone Web Group. 
  Copyright 1998 - 2008
*/

if(typeof QPHOTO=="undefined"){var QPHOTO={};}
new function(){var Q=QPHOTO;Q.widget=Q.widget||{};Q.widget.upActiveX={"_ev":{},"getVersion":function(){if(window.ActiveXObject){try{var t=new ActiveXObject("QQPhotoDrawEx.PhotoDrawEx.1");var v=parseInt(t.GetVersion());return v;}catch(e){return 0;}}else{return-1;}},"addEvent":function(type,fn){if(type.match(/^on/)&&typeof fn=="function"){t._ev[type]=fn;}},"fireEvent":function(type,v){if(typeof t._ev[type]=="function"){if(!QZFL.lang.isArray(v)){v=(typeof v=="undefined")?[]:[v];}
return t._ev[type].apply(null,v);}},"init":function(cfg){if(t.getVersion()<201){return false;}
cfg.onceCount=cfg.onceCount||30;cfg.onceWait=cfg.onceWait||5;cfg.waterIconUrl=cfg.waterIconUrl||"http://imgcache.qq.com/qzone/client/photo/images/qzone_logo.png";t.silentMode=false;var o=$(cfg.cId);if(cfg.styleType==2){t.silentMode=true;cfg.width=100;cfg.height=100;o=QZFL.dom.createElementIn("div",document.body,false,{id:"pUpAtxDiv",style:"width:1px;height:1px;"})}
o.innerHTML=['<OBJECT ID="pUpAtx" CLASSID="CLSID:05F5F404-7C24-4B39-B5CC-340CEDEB9C0D" width="'+cfg.width+'px" height="'+cfg.height+'px">','<PARAM NAME="FrameType" VALUE="0">','<PARAM NAME="EditMaxWidth" VALUE="'+cfg.width+'">','<PARAM NAME="EditMaxHeight" VALUE="'+cfg.height+'">','<PARAM NAME="ActiveFrame" VALUE="1">','<PARAM NAME="TokenContent" VALUE="http://photo.qq.com/">','<PARAM NAME="HelpHyperlink" VALUE="">','<PARAM NAME="UploadLimit" VALUE="'+cfg.count+'">','<PARAM NAME="ReportServerIP" VALUE="127.0.0.1">','<PARAM NAME="ReportServerPort" VALUE="8210">','<PARAM NAME="WaterPressName" VALUE="'+cfg.waterName+'">','<PARAM NAME="WaterPressURL" VALUE="'+cfg.waterUrl+'">','<PARAM NAME="WaterPressDownloadAddress" VALUE="'+cfg.waterIconUrl+'">','<PARAM NAME="WaterPressType" VALUE="'+cfg.waterType+'">','<PARAM NAME="UploadTitleText" VALUE="">','<PARAM NAME="UploadBtnCompress" VALUE="上传原图">','<PARAM NAME="UploadBtnWaterPress" VALUE="加上我的空间地址">','<PARAM NAME="UploadOnceCountLimit" VALUE="'+cfg.onceCount+'">','<PARAM NAME="UploadOnceWaitTime" VALUE="'+cfg.onceWait+'">','<PARAM NAME="WaterPressCheck" VALUE="0">','<PARAM NAME="StyleType" VALUE="'+cfg.styleType+'">','<PARAM NAME="RetryTimes" VALUE="2">','</OBJECT>'].join("");if(t.silentMode){QZFL.dom.setSize(o,1,1);o.style.display="none";}
t._ev={};t._sucMap={};t._errMap={};if(typeof cfg.options=="object"){for(var p in cfg.options){t.addEvent(p,cfg.options[p]);}}
t.eventBind();return true;},eventBind:function(){var ev={"Sink_PrepareToUpload":QPHOTO.widget.upActiveX.startUp,"Sink_PrepareToAddPhoto":QPHOTO.widget.upActiveX.startAddPhoto,"Sink_UploadSelect":QPHOTO.widget.upActiveX.endAddPhoto,"Sink_UploadResult":QPHOTO.widget.upActiveX.upResult,"Sink_ActiveFrame":QZFL.emptyFn,"Sink_UploadOver":QPHOTO.widget.upActiveX.upEndOnce,"Sink_UploadComplete":QPHOTO.widget.upActiveX.upFinish,"Sink_UploadParams":QPHOTO.widget.upActiveX.upParams,"Sink_LeaveControl":QZFL.emptyFn,"Sink_HowToDrag":QPHOTO.widget.upActiveX.howToDrag,"SlientSink_StartUpload":QZFL.emptyFn,"SlientSink_StopUpload":QPHOTO.widget.upActiveX.upEndOnce,"SlientSink_Progress":QPHOTO.widget.upActiveX.progress,"SlientSink_Complete":QPHOTO.widget.upActiveX.upResult,"SlientSink_Error":QPHOTO.widget.upActiveX.error};var o=$("pUpAtx");for(var k in ev){QZFL.event.addEvent(o,k,ev[k]);}},"startAddPhoto":function(){if(t.fireEvent("onStartAddPhoto")!=false){pUpAtx.AddPhoto(0);}},"endAddPhoto":function(size){t._size=size;t.fireEvent("onEndAddPhoto",size);},"startUp":function(){if(t.fireEvent("onStartUp")!=false){if(t.silentMode){pUpAtx.StartUploadSliently();}else{pUpAtx.UploadEx(true);}}},"stopUp":function(bConfirm){if(t.silentMode){pUpAtx.StopUploadSliently();}else{bConfirm=typeof bConfirm=="undefined"?true:bConfirm;pUpAtx.StopUpload(bConfirm);}},"upResult":function(retStr){var d=parseXML(retStr);if(!d){return;}
var o={"code":parseInt(d.selectSingleNode("Result").text,10),"msg":d.selectSingleNode("Reason").text};if(o.code==0||o.code==-301){o.url=d.selectSingleNode("ResultURL").text;o.aid=o.code==-301?d.selectSingleNode("AlbumId").text:"";o.ret=0;t._sucMap[t._aid]=t._sucMap[t._aid]||0;++t._sucMap[t._aid];}else{o.ret=-1;t._errMap[t._aid]=t._errMap[t._aid]||0;++t._errMap[t._aid];}
t.fireEvent("onUpResult",[o,retStr]);},"upEndOnce":function(){QZFL.cookie.del("albumclass");QZFL.cookie.del("albumname");QZFL.cookie.del("albumpriv");QZFL.cookie.del("albumhandset");t.fireEvent("onUpEndOnce");},"upFinish":function(){t.fireEvent("onUpFinish");},"upParams":function(f){t.fireEvent("onUpParams",f);t._flag=f;},"howToDrag":function(){t.fireEvent("onHowToDrag");},"setInput":function(cfg){t._aid=cfg.aid;if(document.domain=="qq.com"){QZFL.cookie.set("albumclass",cfg.classid,"qq.com",null,0.2);QZFL.cookie.set("albumname",restHTML(cfg.name),"qq.com",null,0.2);QZFL.cookie.set("albumpriv",cfg.priv,"qq.com",null,0.2);QZFL.cookie.set("albumhandset",cfg.handset,"qq.com",null,0.2);}
var q=96;pUpAtx.SetUploadInfo(cfg.uin,"08RcbHzk97",cfg.aid,cfg.url,1,0,q,670,800);pUpAtx.SetPhotoCount(cfg.total);if(t.getVersion()>=201){var d=cfg.extData||{};d.albumname=escapeURI(trim(restHTML(cfg.name)));d.albumclass=cfg.classid;d.albumpriv=cfg.priv;d.albumhandset=cfg.handset;d.bgid=cfg.bgid;d.tpid=cfg.tplid;var ex=[];for(var k in d){ex.push(k+"="+d[k]);}
pUpAtx.SetExtendStr(ex.join("&"));}},"getSucCount":function(aid){if(aid){return t._sucMap[aid]||0;}
var c=0;for(var i in t._sucMap){c+=t._sucMap[i];}
return c;},"getErrCount":function(aid){if(aid){return t._errMap[aid]||0;}
var c=0;for(var i in t._errMap){c+=t._errMap[i];}
return c;},"setRetryTimes":function(t){if(t.getVersion()>=221){pUpAtx.SetRetryTimes(t);}},"getPhotoCount":function(){if(t.getVersion()>=221){return pUpAtx.PhotoCount;}},"setWaterName":function(s){if(t.getVersion()>=221){pUpAtx.SetWaterPressName(s);}},"setWaterUrl":function(s){if(t.getVersion()>=221){pUpAtx.SetWaterPressUrl(s);}},"setWaterType":function(type){if(t.getVersion()>=221){pUpAtx.SetWaterPressType(type);}},"resize":function(){if(t.getVersion()>=221&&typeof pUpAtx!="undefined"){pUpAtx.Resize();}},"setOnceCount":function(count){if(t.getVersion()>=221&&typeof pUpAtx!="undefined"){pUpAtx.SetUploadLimit(count);}},"_setUpFile":function(list){var x=[];x.push('<fileList total="'+list.length+'">');for(var i=0;i<list.length;++i){x.push('<file><![CDATA['+trim(list[i])+']]></file>');}
x.push('</fileList>');pUpAtx.SetUploadFilePath(x.join(""));},"setUpFile":function(list){var d=10,i=0,a=[];do{a=list.slice(i,i+d);this._setUpFile(a);i+=d;}while(i<list.length);},"progress":function(p){t.fireEvent("onProgress",p);},"error":function(s){t.fireEvent("onError",s);}};var t=Q.widget.upActiveX;}
new function(){var Q=QPHOTO;Q.dialog=Q.dialog||{};Q.dialog.load=function(el){el.style.display="";var p1=QZFL.dom.getPosition(document.body);var p2=QZFL.dom.getPosition(el);var left=p1.left+(p1.width-p2.width)/2;var top=(QZFL.dom.getClientHeight()-p2.height)/2+QZFL.dom.getScrollTop();QZFL.dom.setXY(el,left,top);QZFL.dom.setStyle(el,"opacity",0);var tw=new QZFL.Tween(el,"top",QZFL.transitions.regularEaseIn,top-30+"px",top+"px",0.3);tw.onMotionChange=function(){QZFL.dom.setStyle(el,"opacity",this.getPercent()/100);}
tw.onMotionStop=function(){QZFL.dom.setStyle(el,"opacity",1);tween1=null;}
tw.start();Q.dialog._maskId=QZFL.maskLayout.create();};Q.dialog.unload=function(el,cb){var tw=new QZFL.Tween(el,"opacity",QZFL.transitions.regularEaseIn,1,0,0.2);tw.onMotionStop=function(){el.style.display="none";tween1=null;if(typeof cb=="function"){cb();}};tw.start();QZFL.maskLayout.remove(Q.dialog._maskId);};Q.util=Q.util||{};Q.util.onWrite=function(s,max,o){var html,len=getRealLen(trim(s));if(len>max){html="<font color=red>"+len+"</font>";}else{html="<font color=green>"+len+"</font>";}
o.innerHTML=html;};function _getHTML(){return['<iframe class="mode_pop_iframe"></iframe>','<div class="mode_pop_wrap">','<div id="d_confirm_drag" class="mode_pop_tit mode_pop_bg mod_clear">','<h3 id="d_confirm_title">title</h3>','<p class="other"><a href="javascript:void(0);" title="关闭" class="mode_pop_bg" onclick="QPHOTO.dialog.confirm.close();return false;">关闭</a></p>','</div>','<div class="pop_create_album_notice">','<p id="d_confirm_content"></p>','</div>','<div class="mode_pop_bottom mode_pop_bg">','<p><button type="button" class="bt_2" onclick="QPHOTO.dialog.confirm.submit();">确定</button></p>','</div>','</div>'].join("");}
Q.dialog.confirm={show:function(cfg){t.cfg=cfg||{};var div=$("d_confirm");if(!div){div=QZFL.dom.createElementIn("div",document.body,false,{"class":"mode_pop","id":"d_confirm","style":"width:300px;display:none;","innerHTML":_getHTML()});QZONE.dragdrop.registerDragdropHandler($("d_confirm_drag"),div,{rangeElement:[QZONE.dom.get(document.body),[1,1,1,1]]});};$("d_confirm_title").innerHTML=t.cfg.title;$("d_confirm_content").innerHTML=t.cfg.content;Q.dialog.load(div);},submit:function(){t.close();if(typeof t.cfg.onConfirm=="function"){t.cfg.onConfirm();}},close:function(){Q.dialog.unload($("d_confirm"));if(typeof t.cfg.onClose=="function"){t.cfg.onClose();}}};var t=Q.dialog.confirm;}
new function(){var Q=QPHOTO;Q.dialog=Q.dialog||{};function _getHTML(){return['<iframe class="mode_pop_iframe"></iframe>','<div class="mode_pop_wrap">','<div id="c_add_title" class="mode_pop_tit mode_pop_bg mod_clear">','<h3>创建相册</h3>','<p class="other"><a href="javascript:void(0);" onclick="QPHOTO.dialog.mAddAlbum.close();return false;" title="关闭" class="mode_pop_bg">关闭</a></p>','</div>','<div class="pop_create_album">','<p><span class="form_name"><label for="AlbumName">相册名称：</label></span><input type="text" id="c_name" name="AlbumName" class="int_txt" onkeyup="QPHOTO.util.onWrite(this.value,30,$(\'c_name_word\'));QPHOTO.dialog.mAddAlbum.onWrite(this.value,30,$(\'c_name_tips\'));" maxlength="30" /><span class="count_txt"><span id="c_name_word">0</span>/30</span></p>','<p class="bg c_tx2 notice" id="c_name_tips" style="display:none">相册名不能为空，请先输入相册名</p>','<p><span class="form_name"><label for="AlbumDesc">相册描述：</label></span><textarea id="c_desc" name="AlbumDesc" class="area_txt" onkeyup="QPHOTO.util.onWrite(this.value,200,$(\'c_desc_word\'));QPHOTO.dialog.mAddAlbum.onWrite(this.value,200,$(\'c_desc_tips\'));"></textarea><span class="count_txt"><span id="c_desc_word">0</span>/200</span></p>','<p class="bg c_tx2 notice" id="c_desc_tips" style="display:none">您已输入500个字符（最多150个字符）</p>','<p class="line_1">','<span class="form_name fn_select"><label for="AlbumSort">分类：</label></span>','<select id="c_class" name="AlbumSort">','<option value="101" selected="selected">人物</option>','<option value="102">风景</option>','<option value="103">动物</option>','<option value="104">游记</option>','<option value="105">卡通</option>','<option value="106">生活</option>','<option value="107">其他</option>','</select>','</p>','<p class="line_1 line_radio">','<span class="form_name fn_select">谁能访问：</span>','<input type="radio" id="All" name="Purview" class="v_radio" checked="1" onclick="QPHOTO.dialog.mAddAlbum.selPriv(1);" /><label for="All">所有人</label> ','<input type="radio" id="Question" name="Purview" class="v_radio" onclick="QPHOTO.dialog.mAddAlbum.selPriv(5);" /><label for="Question">回答问题</label> ','<input type="radio" id="AllFriends" name="Purview" class="v_radio" onclick="QPHOTO.dialog.mAddAlbum.selPriv(4);" /><label for="AllFriends">全部QQ好友</label> ','<input type="radio" id="Myself" name="Purview" class="v_radio" onclick="QPHOTO.dialog.mAddAlbum.selPriv(3);" /><label for="Myself">仅主人</label> ','</p>','<div class="panel_question" id="c_qa" style="display:none">','<p class="line_2">','<label for="QuestionLine">问题：</label><input type="text" id="c_question" name="QuestionLine" class="int_txt int_txt2" onkeyup="QPHOTO.util.onWrite(this.value,20,$(\'c_q_word\'));" maxlength="20" /><span class="count_txt"><span id="c_q_word">0</span>/20</span>','</p>','<p class="line_3">','<label for="AnswerLine">答案：</label><input type="text" id="c_answer" name="AnswerLine" class="int_txt int_txt2" onkeyup="QPHOTO.util.onWrite(this.value,20,$(\'c_a_word\'));" maxlength="20" /><span class="count_txt"><span id="c_a_word">0</span>/20</span>','</p>','<p class="bg c_tx2 notice" id="c_qa_tips" style="display:none">答案不能为空，请先输入答案</p>','</div>','<p class="line_checkbox">','<span class="form_name fn_checkbox">其他权限：</span>','<input type="checkbox" id="reprint" name="reprint" class="v_checkbox" checked="checked" /><label for="reprint" id="reprint_tips">允许QQ好友转载</label>&nbsp;&nbsp;&nbsp; ','<input type="checkbox" id="marked" name="marked" class="v_checkbox" checked="checked" /><label for="marked">允许QQ好友圈圈评论</label>','</p>','<p class="bg c_tx2 notice2" id="c_sys_tips" style="display:none;"></p>','</div>','<div class="mode_pop_bottom mode_pop_bg" id="c_btn">','<p><button type="button" class="bt_2" onclick="QPHOTO.dialog.mAddAlbum.submit();">确定</button> <button type="button" class="bt_2" onclick="QPHOTO.dialog.mAddAlbum.close();">取消</button></p>','</div>','</div>'].join("")}
Q.dialog.mAddAlbum={show:function(cfg){t.cfg=cfg||{};var div=$("c_add_dialog");if(!div){div=QZFL.dom.createElementIn("div",document.body,false,{"class":"mode_pop","id":"c_add_dialog","style":"width:420px;display:none;","innerHTML":_getHTML()});QZONE.dragdrop.registerDragdropHandler($("c_add_title"),div,{rangeElement:[QZONE.dom.get(document.body),[1,1,1,1]]});}
Q.dialog.load(div);t.selPriv(1);},close:function(){Q.dialog.unload($("c_add_dialog"),function(){if(typeof t.cfg.onClose=="function"){t.cfg.onClose();QZFL.dom.removeElement($("c_add_dialog"));}});},selPriv:function(p){t.priv=p;if(p==5){$("c_qa").style.display="";$("c_btn").style.display="none";$("c_btn").style.display="";}else{$("c_qa").style.display="none";$("c_btn").style.display="none";$("c_btn").style.display="";}
var _c=$("reprint");if(p==1&&!t.cfg.isFamous){_c.disabled=false;QZFL.css.removeClassName($("reprint_tips"),"c_tx3");}else{_c.checked=false;_c.disabled=true;QZFL.css.addClassName($("reprint_tips"),"c_tx3");}},checkInput:function(){$("c_name_tips").style.display="none";$("c_desc_tips").style.display="none";$("c_qa_tips").style.display="none";$("c_sys_tips").style.display="none";t["class"]=$("c_class").value;t.name=trim($("c_name").value);t.desc=trim($("c_desc").value);var len1=getRealLen(t.name);var len2=getRealLen(t.desc);if(len1==0){$("c_name_tips").innerHTML="相册名称不能为空，请先输入名称";$("c_name_tips").style.display="";return false;}else if(len1>30){$("c_name_tips").innerHTML="请输入合适长度的相册名称,最多30个字符";$("c_name_tips").style.display="";return false;}else if(len2>200){$("c_desc_tips").innerHTML="请输入合适长度的相册描述,最多200个字符";$("c_desc_tips").style.display="";return false;}
if(t.priv!=5){t.question=t.answer="";return true;}
t.question=trim($("c_question").value);t.answer=trim($("c_answer").value);len1=getRealLen(t.question);len2=getRealLen(t.answer);if(len1==0){$("c_qa_tips").innerHTML="问题不能为空，请先输入问题";$("c_qa_tips").style.display="";return false;}else if(len1>20){$("c_qa_tips").innerHTML="请输入合适长度的问题,最多20个字符";$("c_qa_tips").style.display="";return false;}else if(len2==0){$("c_qa_tips").innerHTML="答案不能为空，请先输入答案";$("c_qa_tips").style.display="";return false;}else if(len2>20){$("c_qa_tips").innerHTML="请输入合适长度的答案,最多20个字符";$("c_qa_tips").style.display="";return false;}
return true;},submit:function(){if(!t.checkInput()){$("c_btn").style.display="none";$("c_btn").style.display="";return;}
var bitmap="100000";if($("marked").checked){bitmap+="0";}else{bitmap+="1";}
if($("reprint").checked){bitmap+="0";}else{bitmap+="1";}
var data={"uin":t.cfg.uin,"qzoneckey":t.cfg.ckey,"qzonecid":66,"albumname":t.name,"albumdesc":t.desc,"albumclass":t["class"],"priv":t.priv,"bitmap":bitmap,"refer":"miniportal","output_type":"json","projectId":123,"pageId":1,"question":t.question,"answer":t.answer};var p=[];for(var k in data){p.push(k+"="+escapeURI(data[k]+""));}
var url=Q.url.get({uin:t.cfg.uin,name:"album_add",refer:"miniportal"});function _Callback(d){if(d.ret==0){t.close();if(typeof t.cfg.onSuccess=="function"){t.cfg.onSuccess(d);}}else{if(typeof t.cfg.onFailed=="function"){t.cfg.onFailed(d);}
$("c_sys_tips").innerHTML=d.msg;$("c_sys_tips").style.display="";$("c_btn").style.display="none";$("c_btn").style.display="";}
data=null;p=null;}
window.external_AddAlbumCallback=function(s){eval(s);}
external.QQPostData(url,"gbk",p.join("&"),"external_AddAlbumCallback");},onWrite:function(s,max,o){var len=getRealLen(trim(s));if(len<=max){o.style.display="none";return;}
o.innerHTML="您已输<font color=red>"+len+"</font>字符 ( 最多"+max+"字符 )";o.style.display="";}};var t=Q.dialog.mAddAlbum;}